<!DOCTYPE html>
<html lang="zh-Hans">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="年轻且优秀，颓废且积极">
    

    <!--Author-->
    
        <meta name="author" content="叶一片">
    

    <!-- Title -->
    
    <title>Hive | 我是叶一片</title>

    <!-- Bootstrap Core CSS -->
    <link href="//cdn.jsdelivr.net/npm/bootstrap@3.3.6/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Custom Fonts -->
    <link href="//cdn.jsdelivr.net/npm/font-awesome@4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Noto+Serif:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- jQuery -->
    <script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="//cdn.jsdelivr.net/npm/bootstrap@3.3.6/dist/js/bootstrap.min.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
<meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="我是叶一片" type="application/atom+xml">
</head>


<body>

    <!-- Content -->
    <section class="article-container">
    <!-- Back Home -->
    <a class="nav-back" href="/">
    <i class="fa fa-puzzle-piece"></i>
</a>

        <!-- Page Header -->
        <header class="intro-header">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                        <div class="post-heading">
                            <h1>
                                Hive
                            </h1>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Post Content -->
        <article>
            <div class="container">
                <div class="row">
                    <!-- Post Main Content -->
                    <div class="post-content col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                        <p>Students表在Hive的多表查询</p>
<span id="more"></span>

<h2 id="1-资料准备"><a href="#1-资料准备" class="headerlink" title="1.资料准备"></a>1.资料准备</h2><p>资料下载：<a target="_blank" rel="noopener" href="https://wwyl.lanzoum.com/isI3P0zrssnc">https://wwyl.lanzoum.com/isI3P0zrssnc</a></p>
<p>字段解释：</p>
<p>课程表：</p>
<table>
<thead>
<tr>
<th align="center">CODE</th>
<th align="center">NAME</th>
<th align="center">PERIOD</th>
<th align="center">CREDIT</th>
</tr>
</thead>
<tbody><tr>
<td align="center">课程编号</td>
<td align="center">课程名称</td>
<td align="center">课时</td>
<td align="center">学分</td>
</tr>
</tbody></table>
<p>任课表：</p>
<table>
<thead>
<tr>
<th align="center">CODE</th>
<th align="center">SEMESTER</th>
<th align="center">TEACHER_ID</th>
<th align="center">COURSE_CODE</th>
</tr>
</thead>
<tbody><tr>
<td align="center">课程编号</td>
<td align="center">学期</td>
<td align="center">任课老师编号</td>
<td align="center">与上表CODE对应</td>
</tr>
</tbody></table>
<p>专业表</p>
<table>
<thead>
<tr>
<th align="center">ID</th>
<th align="center">COLLEGE</th>
<th align="center">MAJOR</th>
<th align="center">GRADE</th>
<th align="center">CLASS</th>
<th align="center">TYPE</th>
</tr>
</thead>
<tbody><tr>
<td align="center">编号</td>
<td align="center">学院</td>
<td align="center">学号</td>
<td align="center">年级</td>
<td align="center">班级</td>
<td align="center">类型</td>
</tr>
</tbody></table>
<p>学生表</p>
<table>
<thead>
<tr>
<th align="center">ID</th>
<th align="center">NAME</th>
<th align="center">GENDER</th>
<th align="center">BIRTHDATE</th>
<th align="center">PHONENUMBER</th>
<th align="center">MAJOR_CLASS</th>
</tr>
</thead>
<tbody><tr>
<td align="center">学生编号</td>
<td align="center">姓名</td>
<td align="center">性别</td>
<td align="center">生日</td>
<td align="center">手机号</td>
<td align="center">专业班级</td>
</tr>
</tbody></table>
<p>选课表</p>
<table>
<thead>
<tr>
<th align="center">COURSE_CLASS_CODE</th>
<th align="center">STUDENT_ID</th>
<th align="center">SCORE</th>
</tr>
</thead>
<tbody><tr>
<td align="center">与表2的CODE对应</td>
<td align="center">学生编号</td>
<td align="center">成绩</td>
</tr>
</tbody></table>
<p>教师表</p>
<table>
<thead>
<tr>
<th align="center">ID</th>
<th align="center">NAME</th>
<th align="center">GENDER</th>
<th align="center">TITLE</th>
</tr>
</thead>
<tbody><tr>
<td align="center">教师编号</td>
<td align="center">姓名</td>
<td align="center">性别</td>
<td align="center">职称</td>
</tr>
</tbody></table>
<h2 id="2-日常操作"><a href="#2-日常操作" class="headerlink" title="2.日常操作"></a>2.日常操作</h2><h3 id="（1）启动、新建文件夹"><a href="#（1）启动、新建文件夹" class="headerlink" title="（1）启动、新建文件夹"></a>（1）启动、新建文件夹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start-all.sh</span><br><span class="line">hadoop fs -mkdir /hadoop_class/student_data</span><br></pre></td></tr></table></figure>

<h3 id="（2）copyFromLocal"><a href="#（2）copyFromLocal" class="headerlink" title="（2）copyFromLocal"></a>（2）copyFromLocal</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -copyFromLocal ~/student/tb_course.csv /hadoop_class/student_data</span><br><span class="line">hadoop fs -copyFromLocal ~/student/tb_course_class.csv /hadoop_class/student_data</span><br><span class="line">hadoop fs -copyFromLocal ~/student/tb_major_class.csv /hadoop_class/student_data</span><br><span class="line">hadoop fs -copyFromLocal ~/student/tb_student.csv /hadoop_class/student_data</span><br><span class="line">hadoop fs -copyFromLocal ~/student/tb_electives.csv /hadoop_class/student_data</span><br><span class="line">hadoop fs -copyFromLocal ~/student/tb_teacher.csv /hadoop_class/student_data</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hive</span><br><span class="line">use username;/*我这次没用*/</span><br></pre></td></tr></table></figure>

<h3 id="（3）建表"><a href="#（3）建表" class="headerlink" title="（3）建表"></a>（3）建表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/*course*/</span><br><span class="line">CREATE EXTERNAL TABLE IF NOT EXISTS course(CODE string,NAME string,PERIOD int,CREDIT int)</span><br><span class="line">row format serde &#x27;org.apache.hadoop.hive.serde2.OpenCSVSerde&#x27;</span><br><span class="line">stored as textfile</span><br><span class="line"></span><br><span class="line">load data inpath &#x27;/hadoop_class/student_data/tb_course.csv&#x27; overwrite into table course;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/*course_class*/</span><br><span class="line">CREATE EXTERNAL TABLE IF NOT EXISTS course_class(CODE string,SEMESTER string,TEACHER_ID int,COURSE_CODE string)</span><br><span class="line">row format serde &#x27;org.apache.hadoop.hive.serde2.OpenCSVSerde&#x27;</span><br><span class="line">stored as textfile</span><br><span class="line"></span><br><span class="line">load data inpath &#x27;/hadoop_class/student_data/tb_course_class.csv&#x27; overwrite into table course_class;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/*major_class*/</span><br><span class="line">CREATE EXTERNAL TABLE IF NOT EXISTS major_class(ID int,COLLEGE string,MAJOR string,GRADE int,CLASS int,TYPE string)</span><br><span class="line">row format serde &#x27;org.apache.hadoop.hive.serde2.OpenCSVSerde&#x27;</span><br><span class="line">stored as textfile;</span><br><span class="line"></span><br><span class="line">load data inpath &#x27;/hadoop_class/student_data/tb_major_class.csv&#x27; overwrite into table major_class;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/*students*/</span><br><span class="line">CREATE EXTERNAL TABLE IF NOT EXISTS students(ID int,NAME string,GENDER string,BIRTHDATE string,PHONENUMBER string,MAJOR_CLASS int)</span><br><span class="line">row format serde &#x27;org.apache.hadoop.hive.serde2.OpenCSVSerde&#x27;</span><br><span class="line">stored as textfile;</span><br><span class="line"></span><br><span class="line">load data inpath &#x27;/hadoop_class/student_data/tb_student.csv&#x27; overwrite into table students;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/*electives*/</span><br><span class="line">CREATE EXTERNAL TABLE IF NOT EXISTS electives(COURSE_CLASS_CODE string,STUDENT_ID int,SCORE int)</span><br><span class="line">row format serde &#x27;org.apache.hadoop.hive.serde2.OpenCSVSerde&#x27;</span><br><span class="line">stored as textfile;</span><br><span class="line"></span><br><span class="line">load data inpath &#x27;/hadoop_class/student_data/tb_electives.csv&#x27; overwrite into table electives;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/*teacher*/</span><br><span class="line">CREATE EXTERNAL TABLE IF NOT EXISTS teacher(ID int,NAME string,GENDER string,TITLE string)</span><br><span class="line">row format serde &#x27;org.apache.hadoop.hive.serde2.OpenCSVSerde&#x27;</span><br><span class="line">stored as textfile;</span><br><span class="line"></span><br><span class="line">load data inpath &#x27;/hadoop_class/student_data/tb_teacher.csv&#x27; overwrite into table teacher;</span><br></pre></td></tr></table></figure>

<h3 id="（4）题目-去表头"><a href="#（4）题目-去表头" class="headerlink" title="（4）题目[去表头]"></a>（4）题目[去表头]</h3><p>1、分析数据：<br>   a、男女生比例<br>   b、学生整体及格率<br>   c、每门课程的平均分，要求显示出课程的中文名字<br>   d、有2门课不及格的学生（重修的学生）<br>   e、课程的及格率，同时要显示老师的名字（绩效考核）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> course <span class="keyword">set</span> TBLPROPERTIES(&quot;skip.header.line.count&quot;<span class="operator">=</span>&quot;1&quot;);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> course_class <span class="keyword">set</span> TBLPROPERTIES(&quot;skip.header.line.count&quot;<span class="operator">=</span>&quot;1&quot;);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> major_class <span class="keyword">set</span> TBLPROPERTIES(&quot;skip.header.line.count&quot;<span class="operator">=</span>&quot;1&quot;);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students <span class="keyword">set</span> TBLPROPERTIES(&quot;skip.header.line.count&quot;<span class="operator">=</span>&quot;1&quot;);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> electives <span class="keyword">set</span> TBLPROPERTIES(&quot;skip.header.line.count&quot;<span class="operator">=</span>&quot;1&quot;);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> teacher <span class="keyword">set</span> TBLPROPERTIES(&quot;skip.header.line.count&quot;<span class="operator">=</span>&quot;1&quot;);</span><br><span class="line"><span class="comment">/*因为第一行有表头 会影响数据*/</span></span><br></pre></td></tr></table></figure>

<h2 id="3-解题"><a href="#3-解题" class="headerlink" title="3.解题"></a>3.解题</h2><h3 id="a、男女生比例"><a href="#a、男女生比例" class="headerlink" title="a、男女生比例"></a>a、男女生比例</h3><p>方法一：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT GENDER,count(*),100*count(*)/SUM(count(*)) over()</span><br><span class="line">FROM students</span><br><span class="line">GROUP BY GENDER;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/649463e91ddac507cc527265.jpg"></p>
<p>方法二：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select t1.male/t2.female from</span><br><span class="line">(select count(1) as male from students where GENDER=&#x27;男&#x27;) t1,</span><br><span class="line">(select count(1) as female from students where GENDER=&#x27;女&#x27;) t2 where 1=1;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/649463ff1ddac507cc5296e2.jpg"></p>
<h3 id="b、学生整体及格率"><a href="#b、学生整体及格率" class="headerlink" title="b、学生整体及格率"></a>b、学生整体及格率</h3><p>方法一：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CREATE TEMPORARY TABLE temp1 AS</span><br><span class="line">SELECT COURSE_CLASS_CODE, COUNT(*) AS totlsum </span><br><span class="line">FROM electives </span><br><span class="line">WHERE SCORE&gt;=60</span><br><span class="line">GROUP BY COURSE_CLASS_CODE;</span><br><span class="line"></span><br><span class="line">CREATE TEMPORARY TABLE temp2 AS</span><br><span class="line">SELECT COURSE_CLASS_CODE, COUNT(*) AS totlsum2 </span><br><span class="line">FROM electives </span><br><span class="line">GROUP BY COURSE_CLASS_CODE;</span><br><span class="line"></span><br><span class="line">SELECT temp1.COURSE_CLASS_CODE,CONCAT(CAST(temp1.totlsum*100/temp2.totlsum2 AS DECIMAL(10,2)),&#x27;%&#x27;)</span><br><span class="line">FROM temp1,temp2</span><br><span class="line">WHERE temp1.COURSE_CLASS_CODE=temp2.COURSE_CLASS_CODE;</span><br><span class="line">/*SELECT CONCAT(CAST(value AS DECIMAL(10,2)), &#x27;%&#x27;) FROM table_name;</span><br><span class="line">执行以上 HiveQL 查询后，返回的结果会将 value 列中的所有数值格式化为保留两位小数并添加百分号的形式*/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/649464081ddac507cc52a3be.jpg"></p>
<p>方法二：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT t1.pass/t2.total </span><br><span class="line">FROM (SELECT COUNT(1) as pass </span><br><span class="line">      FROM electives </span><br><span class="line">      WHERE SCORE &lt;60)t1,</span><br><span class="line">      (SELECT COUNT(1) as total </span><br><span class="line">      FROM electives)t2;</span><br><span class="line">      </span><br><span class="line">SELECT ROUND(SUM(IF(SCORE&gt;=60,1,0))/COUNT(1),2) FROM electives;</span><br><span class="line">/*ROUND函数 将数字四舍五入到指定的位数。*/</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/6494641a1ddac507cc52bb8a.jpg"></p>
<h3 id="c、每门课程的平均分，要求显示出课程的中文名字"><a href="#c、每门课程的平均分，要求显示出课程的中文名字" class="headerlink" title="c、每门课程的平均分，要求显示出课程的中文名字"></a>c、每门课程的平均分，要求显示出课程的中文名字</h3><p>方法一：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TEMPORARY TABLE temp3 AS</span><br><span class="line">    SELECT COURSE_CLASS_CODE,SPLIT(COURSE_CLASS_CODE, &#x27;\\.&#x27;)[0] AS code,avg(score) AS avg1 </span><br><span class="line">    from electives </span><br><span class="line">    group by COURSE_CLASS_CODE;</span><br><span class="line"></span><br><span class="line">SELECT t1.code,avg(avg1),t2.NAME</span><br><span class="line">FROM temp3 t1,course t2</span><br><span class="line">WHERE t1.code=t2.CODE</span><br><span class="line">GROUP BY t1.code,t2.NAME;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/649464251ddac507cc52c9f7.jpg"></p>
<p>方法二：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/*非严格模式*/</span><br><span class="line">SELECT t2.NAME,ROUND(AVG(SCORE),2) AS avg_score</span><br><span class="line">FROM electives t1,course t2,course_class t3</span><br><span class="line">WHERE</span><br><span class="line">t1.COURSE_CLASS_CODE = t3.CODE AND</span><br><span class="line">t2.CODE = t3.COURSE_CODE</span><br><span class="line">GROUP BY t2.NAME;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/6494642f1ddac507cc52d8be.jpg"></p>
<p>方法三：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT t2.NAME,ROUND(AVG(SCORE),2)AS avg_score FROM electives t1</span><br><span class="line">LEFT JOIN course_class t3 ON t1.COURSE_CLASS_CODE=t3.CODE</span><br><span class="line">LEFT JOIN course t2 ON t2.CODE=t3.COURSE_CODE</span><br><span class="line">GROUP BY t2.NAME;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/6494643b1ddac507cc52ea67.jpg"></p>
<p>方法四：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT t1.COURSE_CLASS_CODE,t2.NAME,t1.avg_score</span><br><span class="line">FROM</span><br><span class="line">(SELECT COURSE_CLASS_CODE,ROUND(AVG(SCORE),2)AS avg_score FROM electives GROUP BY COURSE_CLASS_CODE)t1</span><br><span class="line">LEFT JOIN course_class t3 ON t1.COURSE_CLASS_CODE=t3.CODE</span><br><span class="line">LEFT JOIN course t2 ON t2.CODE=t3.COURSE_CODE;</span><br><span class="line"></span><br><span class="line">/*FULL OUTER,LEFT ,RIGHT,CROSS JOIN 都可以*/</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/6494644a1ddac507cc5302c9.jpg"></p>
<h3 id="d、有2门课不及格的学生（重修的学生）"><a href="#d、有2门课不及格的学生（重修的学生）" class="headerlink" title="d、有2门课不及格的学生（重修的学生）"></a>d、有2门课不及格的学生（重修的学生）</h3><p>方法一：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TEMPORARY TABLE temp4 AS</span><br><span class="line">    SELECT STUDENT_ID,count(*) AS count1</span><br><span class="line">    FROM electives</span><br><span class="line">    WHERE SCORE&lt;60</span><br><span class="line">    GROUP BY STUDENT_ID;</span><br><span class="line"></span><br><span class="line">SELECT t1.NAME,t2.count1</span><br><span class="line">FROM students t1,temp4 t2</span><br><span class="line">WHERE t1.ID=t2.STUDENT_ID AND count1&gt;=2;/*有2门课不及格的学生（重修的学生） 所以是&gt;=2*/</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/649464531ddac507cc53134d.jpg"></p>
<p>方法二：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT t1.STUDENT_ID,t2.NAME,t1.score</span><br><span class="line">FROM</span><br><span class="line">(SELECT STUDENT_ID,SUM(IF(SCORE&lt;60,1,0))AS score FROM electives GROUP BY STUDENT_ID HAVING score&gt;=2)t1</span><br><span class="line">LEFT JOIN student t2 ON t2.ID=t1.STUDENT_ID;</span><br><span class="line">/*姓名会显示失败，暂时没有解决*/</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/6494645d1ddac507cc532208.jpg"></p>
<h3 id="e、课程的及格率，同时要显示老师的名字（绩效考核）"><a href="#e、课程的及格率，同时要显示老师的名字（绩效考核）" class="headerlink" title="e、课程的及格率，同时要显示老师的名字（绩效考核）"></a>e、课程的及格率，同时要显示老师的名字（绩效考核）</h3><p>方法一：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/*课程平均分绩效*/</span><br><span class="line">CREATE TEMPORARY TABLE temp5 AS</span><br><span class="line">    SELECT t1.COURSE_CLASS_CODE,t2.TEACHER_ID AS ID1,avg(t1.score) AS avg1 </span><br><span class="line">    FROM electives t1,course_class t2</span><br><span class="line">    WHERE t1.COURSE_CLASS_CODE=t2.CODE</span><br><span class="line">    GROUP BY t1.COURSE_CLASS_CODE,t2.TEACHER_ID</span><br><span class="line">    ORDER BY t2.TEACHER_ID;</span><br><span class="line"></span><br><span class="line">SELECT t1.COURSE_CLASS_CODE,t1.ID1,t2.NAME,t1.avg1</span><br><span class="line">FROM temp5 t1,teacher t2</span><br><span class="line">WHERE t1.ID1=t2.ID;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/649464671ddac507cc53313c.jpg"></p>
<p>方法二：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT t1.COURSE_CLASS_CODE,t1.per,t3.NAME</span><br><span class="line">FROM</span><br><span class="line">(SELECT COURSE_CLASS_CODE,ROUND(SUM(IF(SCORE&gt;=60,1,0))/COUNT(*),4) AS per</span><br><span class="line">FROM electives</span><br><span class="line">GROUP BY COURSE_CLASS_CODE)t1</span><br><span class="line">LEFT JOIN course_class t2 ON t1.COURSE_CLASS_CODE=t2.CODE</span><br><span class="line">LEFT JOIN teacher t3 on t2.teacher_id = ID</span><br><span class="line">ORDER BY t3.NAME;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/649464711ddac507cc533f1c.jpg"></p>
<h3 id="f、老师教了几门课"><a href="#f、老师教了几门课" class="headerlink" title="f、老师教了几门课"></a>f、老师教了几门课</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT t1.NAME AS TEACHER_NAME, COUNT(t2.COURSE_CODE) </span><br><span class="line">FROM teacher t1</span><br><span class="line">JOIN course_class t2 ON t1.ID = t2.TEACHER_ID</span><br><span class="line">GROUP BY t1.NAME;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/6494647b1ddac507cc534da1.jpg"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/*最后要记得*/</span><br><span class="line">stop-all.sh</span><br></pre></td></tr></table></figure>



                            <!-- Meta -->
                            <div class="post-meta">
                                <hr>
                                <br>
                                <div class="post-tags">
                                    
                                        

<a href="/tags/编程/">#编程</a> <a href="/tags/Hadoop/">#Hadoop</a> <a href="/tags/Hive/">#Hive</a> <a href="/tags/大数据平台核心技术/">#大数据平台核心技术</a>


                                            
                                </div>
                                <div class="post-date">
                                    
                                        2023-04-28
                                    
                                </div>
                            </div>
                    </div>

                    <!-- Comments -->
                    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                        <!-- Disqus Comments -->


                    </div>
                </div>
            </div>
        </article>
</section>

<!-- Image viewer-->

    <!-- Custom picture view-->
    <link href="/css/viewer.min.css" rel="stylesheet" />
    <script
      src="/js/viewer.min.js"
      type="text/javascript"
      charset="utf-8"
    ></script>
    
    <script type="text/javascript">
      // set image viewer
      Viewer.setDefaults({
        zoomRatio: [0.5],
        navbar: false,
        toolbar: false,
        button: false,
        title: [2, (image, imageData) => `${image.alt}`],
        show: function() {
          this.viewer.zoomTo(0.5);
        }
      });
      var imageList = document.getElementsByTagName("img");
      Array.prototype.forEach.call(imageList, element => {
        var viewer = new Viewer(element);
      });
    </script>

    

<!-- TOC -->

    <aside id="article-toc" role="navigation" class="fixed">
        <div id="article-toc-inner">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%B5%84%E6%96%99%E5%87%86%E5%A4%87"><span class="toc-text">1.资料准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%97%A5%E5%B8%B8%E6%93%8D%E4%BD%9C"><span class="toc-text">2.日常操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%90%AF%E5%8A%A8%E3%80%81%E6%96%B0%E5%BB%BA%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-text">（1）启动、新建文件夹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89copyFromLocal"><span class="toc-text">（2）copyFromLocal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E5%BB%BA%E8%A1%A8"><span class="toc-text">（3）建表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89%E9%A2%98%E7%9B%AE-%E5%8E%BB%E8%A1%A8%E5%A4%B4"><span class="toc-text">（4）题目[去表头]</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%A7%A3%E9%A2%98"><span class="toc-text">3.解题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#a%E3%80%81%E7%94%B7%E5%A5%B3%E7%94%9F%E6%AF%94%E4%BE%8B"><span class="toc-text">a、男女生比例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b%E3%80%81%E5%AD%A6%E7%94%9F%E6%95%B4%E4%BD%93%E5%8F%8A%E6%A0%BC%E7%8E%87"><span class="toc-text">b、学生整体及格率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c%E3%80%81%E6%AF%8F%E9%97%A8%E8%AF%BE%E7%A8%8B%E7%9A%84%E5%B9%B3%E5%9D%87%E5%88%86%EF%BC%8C%E8%A6%81%E6%B1%82%E6%98%BE%E7%A4%BA%E5%87%BA%E8%AF%BE%E7%A8%8B%E7%9A%84%E4%B8%AD%E6%96%87%E5%90%8D%E5%AD%97"><span class="toc-text">c、每门课程的平均分，要求显示出课程的中文名字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#d%E3%80%81%E6%9C%892%E9%97%A8%E8%AF%BE%E4%B8%8D%E5%8F%8A%E6%A0%BC%E7%9A%84%E5%AD%A6%E7%94%9F%EF%BC%88%E9%87%8D%E4%BF%AE%E7%9A%84%E5%AD%A6%E7%94%9F%EF%BC%89"><span class="toc-text">d、有2门课不及格的学生（重修的学生）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#e%E3%80%81%E8%AF%BE%E7%A8%8B%E7%9A%84%E5%8F%8A%E6%A0%BC%E7%8E%87%EF%BC%8C%E5%90%8C%E6%97%B6%E8%A6%81%E6%98%BE%E7%A4%BA%E8%80%81%E5%B8%88%E7%9A%84%E5%90%8D%E5%AD%97%EF%BC%88%E7%BB%A9%E6%95%88%E8%80%83%E6%A0%B8%EF%BC%89"><span class="toc-text">e、课程的及格率，同时要显示老师的名字（绩效考核）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#f%E3%80%81%E8%80%81%E5%B8%88%E6%95%99%E4%BA%86%E5%87%A0%E9%97%A8%E8%AF%BE"><span class="toc-text">f、老师教了几门课</span></a></li></ol></li></ol>
        </div>
    </aside>

    <!-- Scripts -->
    <script type="text/javascript">
    console.log("© zchen9 🙋 2015-" + new Date().getFullYear());
</script>
  
    <!-- Google Analytics -->
    

    <!-- Service Worker -->
    <!-- if using service worker -->

    
</body>

</html>